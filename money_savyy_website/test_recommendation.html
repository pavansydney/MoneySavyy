<!DOCTYPE html>
<html>
<head>
    <title>Test Recommendation Display</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h2>Test Recommendation Display</h2>
        
        <div class="card mb-3">
            <div class="card-body">
                <h5>Current Issue (Object Display):</h5>
                <div id="recommendation-old"></div>
            </div>
        </div>
        
        <div class="card mb-3">
            <div class="card-body">
                <h5>Fixed Display:</h5>
                <div id="recommendation"></div>
            </div>
        </div>
        
        <button class="btn btn-primary" onclick="testRecommendation()">Test Recommendation</button>
    </div>

    <script>
        // Mock data that represents the API response
        const mockData = {
            recommendation: {
                recommendation: "Buy",
                color: "success",
                confidence: "Medium",
                score: 7.5
            }
        };

        // Old broken function (shows [object Object])
        function updateRecommendationOld(rec) {
            const recDiv = document.getElementById('recommendation-old');
            recDiv.innerHTML = `
                <span class="badge bg-${rec.color}">
                    <i class="fas fa-chart-line me-1"></i>
                    ${rec}
                </span>
                <small class="d-block mt-1 text-muted">
                    Confidence: ${rec.confidence} | Score: ${rec.score}
                </small>
            `;
        }

        // New fixed function
        function updateRecommendation(rec) {
            const recDiv = document.getElementById('recommendation');
            
            // Handle both old format (direct string) and new format (object)
            let recommendationText, color, confidence, score;
            
            if (typeof rec === 'object' && rec.recommendation) {
                // New format with nested structure
                recommendationText = rec.recommendation;
                color = rec.color || 'secondary';
                confidence = rec.confidence || 'Medium';
                score = rec.score || 0;
            } else if (typeof rec === 'string') {
                // Old format (direct string)
                recommendationText = rec;
                color = rec.includes('Buy') ? 'success' : rec.includes('Sell') ? 'danger' : 'warning';
                confidence = 'Medium';
                score = 7.0;
            } else {
                // Fallback
                recommendationText = 'Hold';
                color = 'warning';
                confidence = 'Low';
                score = 5.0;
            }
            
            const badgeClass = `badge bg-${color}`;
            
            recDiv.innerHTML = `
                <span class="${badgeClass}">
                    <i class="fas fa-chart-line me-1"></i>
                    ${recommendationText}
                </span>
                <small class="d-block mt-1 text-muted">
                    Confidence: ${confidence} | Score: ${typeof score === 'number' ? score.toFixed(1) : score}
                </small>
            `;
        }

        function testRecommendation() {
            // Test old function (broken)
            updateRecommendationOld(mockData.recommendation);
            
            // Test new function (fixed)
            updateRecommendation(mockData.recommendation);
        }

        // Run test on page load
        testRecommendation();
    </script>
</body>
</html>
